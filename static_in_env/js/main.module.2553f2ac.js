/*! 
 * esewaHomeApp v0.0.0
 * 
 * Copyright (c) 2019 eSewa Developers <developers@esewa.com.np>
 * License: eSewa
+; * Version: 0.0.0
+; */
!function(){angular.module("esewaUserApp",["ui.router","restangular","ui.bootstrap","infinite-scroll","esewaComponents","esewaMessages","esewaSharedApp","esewaPaymentMenuApp","vcRecaptcha","ngCookies","base64"]).run(["$rootScope","$state","$http","AUTH_EVENTS","AuthService","$timeout","$sce","$location","StateConstant","CDNUrl","$templateCache","ecmsg","$cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.$state=b,a.StateConstant=i,a.successResponse={message:""},a.message={error:"",success:"",information:"",show:!1},a.cleanStorage=function(){a.initialRequirement={},a.userBalance="",a.UserRewardPoint="",a.dismissModal=!0};var n=m.get("errormsg"),o=m.get("successmsg");n&&n.length>3?l.error(n,""):o&&o.length>3&&l.success(o,""),a.logout=function(){a.clearMessage(),a.cleanStorage();var c=document.querySelector("#ACCOUNT_ICON");c&&(c.src=j.defaultAccountUrl),b.current.name.startsWith("login")||b.go("login")},a.currentModal=void 0,a.isLoggedIn=function(){var b=a.userAuth;return angular.isDefined(b)&&angular.isDefined(b.uuid)},a.isAuthenticated=function(){return a.isLoggedIn()},a.$on(d.loginSuccess,function(){a.initialRequirement.form||(a.targetLogin?a.serveUrlChanges():(b.current.name.startsWith("static")||b.current.name.startsWith("authentication"))&&b.go(i.HOME_MAIN))}),a.$on(d.loginFailed,function(){a.targetLogin||a.logout()}),a.$on(d.notAuthenticated,function(){a.targetLogin||a.logout()}),a.$on(d.notAuthorized,function(){a.targetLogin||a.logout()}),a.$on(d.sessionTimeout,function(){l.error("","Session expired. Please login again."),a.logout()}),a.clearMessage=function(){a.message={},a.dismissModal=!0,a.information={},a.trustedHtml="",a.showInformation=!1,a.credentials={},a.currentModal&&a.currentModal.dismiss()},a.serveUrlChanges=function(){h.absUrl()==a.targetLogin,a.currentModal&&a.currentModal.dismiss()},a.$on("$stateChangeStart",function(b,c,e){a.information={},a.message={},a.showInformation=!1,"login"!==c.name&&"allShowcase"!==c.name&&"download"!==c.name&&f(function(){a.isAuthenticated()||c.name.startsWith("authentication")||c.name.startsWith("static")||c.name.startsWith("serviceList")||c.name.startsWith("main")||c.name.startsWith("activate")||c.name.startsWith("merchant.makePayment")||c.name.startsWith("merchant.airlines")||(a.$broadcast(d.notAuthenticated),b.preventDefault())},10)}),b.current.name.startsWith("home")&&(a.showMostUsedServices=!0,a.showAddServices=!0),a.getParentStyle=function(){return b.current.name.startsWith("merchant.airlines")?"padding-left:0px":""},a.showErrorMessage=function(){return!(!a.message||a.targetLogin)&&(a.message.error&&!(b.current.name.startsWith("auth")&&a.isAuthenticated()))},a.generateCaptcha=function(a){var b=document.querySelector("#CAPTCHA");c({method:"GET",url:"/api/web/captcha/"+a,headers:{"Content-Type":void 0,Accept:"data:image/png;charset=utf-8;base64"},responseType:"arraybuffer",data:""}).success(function(a){var c=new Blob([a],{type:"image/png"}),d=window.URL||window.webkitURL,e=d.createObjectURL(c);b&&(b.src=e)}).error(function(){})},f(function(){var b=h.port();80!==b&&(b=":"+b),a.domainName=h.protocol()+"://"+h.host()+b,h.port()===d.devGruntPort&&(a.domainName=h.protocol()+"://"+h.host()+":"+d.devServerPort)},3e3),f(function(){c({method:"GET",url:"/api/web/captcha_server_code",headers:{"Content-Type":void 0,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"},data:""}).success(function(b){a.publicKey=b}).error(function(){})},3e3)}])}(),function(){angular.module("esewaUserApp").config(["$stateProvider","$urlRouterProvider","CDNUrl",function(a,b,c){b.otherwise("/home"),a.state("login",{url:"/home",templateUrl:"user/authentication/views/login.html",controller:"LoginController"}).state("main",{"abstract":!0,template:"<div  ui-view/>"}).state("main.landing",{url:"/main",templateUrl:"user/home/views/home_page.html",controller:"LoginController",data:{displayName:"Home"}}).state("main.initialRequirement",{url:"/initial_requirement",templateUrl:"user/authentication/views/initial_requirement.html",controller:"InitialRequirementController",data:{displayName:"Initial Requirement"}}).state("fundFrom",{"abstract":!0,url:"/bank_load",templateUrl:"user/static/views/bank_load.html"}).state("fundFrom.internetBanking",{url:"/internet_banking",templateUrl:"user/static/views/internet_banking.html",controller:"BankInfoController",data:{displayName:"Internet Banking"}}).state("fundFrom.mobileBanking",{url:"/mobile_banking",templateUrl:"user/static/views/mobile_banking.html",controller:"BankInfoController",data:{displayName:"Mobile Banking"}}).state("fundFrom.friend",{url:"/friend",templateUrl:"user/merchant/payments/views/request_from_friend.html",controller:"BankInfoController",data:{displayName:"Friend"}}).state("static",{"abstract":!0,template:'<div ui-view class="x_panel" "/>'}).state("static.westernUnion",{url:"/western_union",templateUrl:"user/static/views/western_union.html",controller:"StaticController",data:{displayName:"Western Union"}}).state("static.smsSyntax",{url:"/sms_syntax",templateUrl:"user/static/views/sms_syntax.html",controller:"StaticController",data:{displayName:"SMS Syntax"}}).state("static.aboutEsewa",{url:"/about_esewa",templateUrl:"user/static/views/about_esewa.html",controller:"StaticController",data:{displayName:"About eSewa"}}).state("static.faqs",{url:"/faqs",templateUrl:"user/static/views/faqs.html",controller:"StaticController",data:{displayName:"FAQs"}}).state("static.mobileApps",{url:"/mobile_apps",templateUrl:"user/static/views/mobile_apps.html",controller:"StaticController",data:{displayName:"Mobile Apps"}}).state("static.rewardPoint",{url:"/reward_point",templateUrl:"user/static/views/reward_point.html",controller:"StaticController"}).state("static.contactInformation",{url:"/contact_information",templateUrl:"user/static/views/contact_information.html",controller:"StaticController",data:{displayName:"Contacts"}}).state("static.privacy",{url:"/privacy",templateUrl:"user/static/views/privacy.html",controller:"StaticController",data:{displayName:"Privacy"}}).state("static.gettingStarted",{url:"/getting_started",templateUrl:"user/static/views/getting_started.html",controller:"StaticController",data:{displayName:"Getting Started"}}).state("static.security",{url:"/security",templateUrl:"user/static/views/security.html",controller:"StaticController",data:{displayName:"Security"}}).state("static.termsAndConditions",{url:"/terms_and_conditions",templateUrl:"user/static/views/terms_and_conditions.html",controller:"StaticController",data:{displayName:"Terms and Conditions"}}).state("authentication",{"abstract":!0,template:'<div ui-view ng-hide="isLoggedIn()" />'}).state("authentication.signup",{url:"/signup",templateUrl:"user/authentication/views/sign_up_form.html",controller:"SignUpController",data:{displayName:"Sign Up"}}).state("authentication.forgotPassword",{url:"/forgot_password",templateUrl:c.url+"/html/templates/forgot_password.html",controller:"ForgotPasswordController",data:{displayName:"Forgot Password"}}).state("authentication.setPassword",{url:"/home",templateUrl:"user/authentication/views/set_password_for_inactive_user.html",controller:"LoginController",data:{displayName:"Set Password"}}).state("activateNotification",{url:"/notification/activate_email?:token",templateUrl:"user/notificationids/views/email_activation.html",controller:"ActivationController",data:{displayName:"Notification Email Activation"}}).state("activate",{url:"/activate","abstract":!0,template:'<div class="theme_box" ui-view/>'}).state("activate.setPasswordForEmailUser",{url:"/signup?:token",templateUrl:"user/logincredentials/views/set_password_for_secondary_email_user.html",controller:"ActivationController",data:{displayName:"Email User Activation"}}).state("activate.setPasswordForPrimaryUser",{url:"/signup/verify?:token",templateUrl:"user/logincredentials/views/set_password_for_email_user.html",controller:"ActivationController",data:{displayName:"User Activation"}}).state("activate.setForgottenPassword",{url:"/forgot_password?:token",templateUrl:"user/authentication/views/set_forgotten_password.html",controller:"ActivationController",data:{displayName:"Activate"}})}])}(),function(){angular.module("esewaUserApp").config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","AUTH_EVENTS","CDNUrl","ecmsg",function(a,b,c,d,e){return{request:function(b){return angular.isDefined(a.isLoggedIn)?(_.includes(b.url,d.url)?_.includes(b.url,"/documents")&&_.includes(b.url,".jpg")&&(b.headers.CacheControl="no-cache"):a.isLoggedIn()&&(_.includes(b.url,"/auth")||_.includes(b.url,"/logout")||_.includes(b.url,"/airlines"))&&(b.headers.uuid=a.userAuth.uuid),a.disableSubmit=!0,b):b},response:function(b){return a.disableSubmit=!1,b},responseError:function(d){a.disableSubmit=!1;var f=d.status;if(!_.includes(d.config.url,"reg")&&!_.includes(d.config.url,"authenticate")&&!_.includes(d.config.url,"forgot_password")){if(a.message={error:""},401===f||403===f)a.$broadcast(c.notAuthorized),a.message.error&&(_.includes(d.config.url,"payment_menus")||_.includes(d.config.url,"/products/showcase")||e.error(a.message.error,""));else if(500===f)return e.error("Sorry, something went wrong.",""),b.reject(d);""!==a.message.error&&angular.isDefined(a.message.error)&&(a.message.error?(e.error(a.message.error,""),document.body.scrollTop=document.documentElement.scrollTop=0):angular.isDefined(d.data.error_message)&&(_.includes(d.config.url,"make_payment")||_.includes(d.config.url,"payment")||_.includes(d.config.url,"validate")?a.message.error=d.data.error_message:_.includes(d.config.url,"payment_menus")||_.includes(d.config.url,"/products/showcase")||e.error(d.data.error_message,"")))}return b.reject(d)}}}])}])}(),function(){angular.module("esewaUserApp").controller("LoginController",["$scope","$rootScope","$state","AuthService","$http","AUTH_EVENTS","$timeout","$filter","ecmsg","ValidationService","StateConstant","$modal","ForgotPasswordService","$location","CDNUrl","$q","$window","$base64","$localStorage",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a){var b=p.defer(),c=new Image;return c.onerror=function(){b.resolve(!1)},c.onload=function(){b.resolve(!0)},c.src=a,b.promise}b.clearMessage(),a.password={},b.showApplicationProcessing=!1;var u="Invalid username or password";a.FocusLogin=!0,b.login=function(a){return b.error={},a.esewaId?a.password?void e({method:"POST",url:"/authenticate",headers:{esewa_id:a.esewaId,password:r.encode(a.password)},params:{redirectForm:angular.isDefined(a.url)?a.url:""},data:""}).success(function(a){a?(a.location.indexOf("?transfer=")<0&&(s.redirectUrl=a.location,q.location.reload()),q.location.href=a.location):q.location.reload()}).error(function(d){b.loginErrorSHow=!0,d?d.set_password?(b.passwordDto={esewaId:a.esewaId},i.info(d.set_password),c.go("authentication.setPassword")):d.error_message?b.loginError=d.error_message:b.loginError=u:b.loginError=u,g(function(){b.loginErrorSHow=!1},3e4)}):(b.loginError="Invalid Password",b.loginErrorSHow=!0,g(function(){b.loginErrorSHow=!1},2e3),!1):(b.loginError="Invalid eSewa ID",b.loginErrorSHow=!0,g(function(){b.loginErrorSHow=!1},2e3),!1)},a.checkPassword=function(){return a.passwordDto.newPassword===a.passwordDto.confirmNewPassword},a.checkPasswordValid=function(a,b){return a===b},a.checkPasswordRegex=function(a){return/[a-zA-z]/.test(a)&&/[0-9]/.test(a)&&a.length>7},a.disableButtonCondition=function(){return!a.checkPassword(a.passwordDto.newPassword,a.passwordDto.confirm_password)||!a.checkPasswordRegex(a.passwordDto.newPassword)||!a.checkPasswordRegex(a.passwordDto.confirmNewPassword)},a.setPassword=function(c){var d={password:c.newPassword,token:c.token,esewa_id:c.esewaId};a.disableButtonCondition()?i.error("Invalid password format.",""):m.setPasswordForInactiveUser(d).then(function(){b.clearMessage(),b.login({password:d.password,esewaId:d.esewa_id})},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?i.error(a.data.error_message,""):i.error("Service is currently unavailable. please, try again later to set password for the credentials."))})},b.openLoginDialog=function(a){return l.open({templateUrl:"/user/authentication/views/home_login_dialog.html",controller:"LoginPopupController",size:"login",backdrop:"static",keyboard:!1,resolve:{url:function(){return a}}})},a.getProfileImage=function(){var b=document.querySelector("#ACCOUNT_ICON");b&&(b.src=a.getUserIcon()),e({method:"GET",url:"/api/web/auth/kyc/document/download",headers:{"Content-Type":void 0,uuid:e.defaults.headers.common.uuid},data:""}).success(function(b){b.file_name&&g(function(){var c=document.querySelector("#ACCOUNT_ICON");c&&(c.src="",t(b.file_name).then(function(d){d===!0?c.src=b.file_name:c.src=a.getUserIcon()}))},500)}).error(function(){g(function(){b&&(b.src=a.getUserIcon())},500)})},a.getUserIcon=function(){return o.defaultAccountUrl}}])}(),function(){angular.module("esewaUserApp").service("AuthService",["Restangular",function(a){var b=a.all("auth"),c=a.all("esewa");this.authenticate=function(b){return a.one("authenticate").customPOST("","","",{esewa_id:b.esewaId,password:b.password})},this.registerUserUsingEsewaId=function(a,b){var d={esewa_id:a.esewaId,email:a.email,"g-recaptcha-response":b,terms_and_conditions:a.termsAndCondition};return c.all("reg").post(d)},this.validateToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.validateLastToken=function(a){return c.one(a.esewaId+"").one("token").one(a.token+"").one("validate").customGET()},this.changePassword=function(a){return b.one("change_password").customPUT("","","",{old_password:a.oldPassword,new_password:a.newPassword,mpin:a.mpin})},this.setPassword=function(a){var b={token:a.token};return c.one(a.esewaId+"").one("create_password").customPOST(b,"","",{password:a.password,mpin:a.mpin})},this.getInitialRequirements=function(){return b.one("initial_requirements").get()},this.getUserProfile=function(){return b.one("profile").customGET()},this.logout=function(b){return a.all("logout").customPOST("","","",{esewa_id:b})}}])}(),function(){angular.module("esewaUserApp").service("ForgotPasswordService",["Restangular",function(a){this.validateForgotPasswordId=function(b,c){return a.one(b+"").one("forgot_password").customGET("",{},{"g-recaptcha-response":c})},this.validateToken=function(b){return a.one(b.esewaId+"").one("forgot_password/validate").one(b.token+"").customGET()},this.setPasswordForgotPassword=function(b){var c={token:b.token,password:b.password};return a.one(b.esewaId+"").one("forgot_password").customPUT(c)},this.setPasswordForInactiveUser=function(b){return a.one(b.esewa_id+"").one("set_password").customPUT(b)}}])}(),function(){angular.module("esewaUserApp").controller("SignUpController",["$scope","$state","$timeout","$rootScope","ecmsg","InformationService","$sce","INFORMATION","StateConstant","$modal",function(a,b,c,d,e,f,g,h,i,j){d.openSignUpDialog=function(a){return j.open({templateUrl:"/user/authentication/views/sign_up_form.html",controller:"SignUpPopUpController",size:"signUp",backdrop:"static",keyboard:!1,resolve:{loginData:function(){return a}}})}}])}(),function(){angular.module("esewaUserApp").controller("LoginPopupController",["$rootScope","$scope","url","$state","$modalInstance","$timeout",function(a,b,c,d,e,f){b.cancel=function(){e.dismiss()},a.url=c,a.currentModal=e,b.login=function(b){angular.isDefined(c)&&""!==c&&(b.url=c),a.login(b),f(function(){a.isLoggedIn()&&e.dismiss()},2e3)}}])}(),function(){angular.module("esewaUserApp").controller("SignUpPopUpController",["$rootScope","ecmsg","AUTH_EVENTS","AuthService","INFORMATION","$scope","loginData","$state","$modalInstance","$timeout","vcRecaptchaService",function(a,b,c,d,e,f,g,h,i,j,k){f.cancel=function(){i.dismiss()},a.targetLogin=g,a.currentModal=i,f.tokenDto="",f.showRegFormView=!f.showAlreadyGotTokenView;var l=e.primaryRegistration;a.showInformation=l,a.isLoggedIn()&&h.current.name===StateConstant.SIGN_UP&&a.logout(),f.showSignUpView=function(){f.showRegFormView=!0,f.showEmailSentView=!0,h.go(StateConstant.SIGN_UP)},f.clearFormData=function(){f.signUpDto={esewaId:"",termsAndCondition:!1,token:""},f.tokenDto={token:"",esewaId:""},f.passwordDto={newPassword:"",confirmNewPassword:"",mpin:""},f.activationDto={esewaId:"",token:""}},f.clearFormData(),f.clearMessage=function(){a.message.error="",f.signUpMessage=""};var m;f.getRecaptchaId=function(a){m=a},f.registerUser=function(){return a.showApplicationProcessing=!0,void 0===f.signUpDto?void(f.signUpMessage="Please type your mobile number !"):(f.clearMessage(),void(k.getResponse(m)?(d.registerUserUsingEsewaId(f.signUpDto,k.getResponse(m)).then(function(b){a.showApplicationProcessing=!1,f.registrationResponse=b,f.showRegFormView=!1,f.showEmailSentView=!0},function(c){a.showApplicationProcessing=!1,a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error occurred while registration, please, try again later.")}),k.reload(m)):(a.message.error="Please resolve the captcha and submit!",a.showApplicationProcessing=!1)))},f.validateToken=function(){f.clearMessage();var c={token:f.tokenDto.token,esewaId:f.signUpDto.esewaId};d.validateToken(c).then(function(a){f.tokenDtoValidationRespone=a.plain(),f.tokenDtoValidation=!1,f.showRegFormView=!1,f.showTokenValidationView=!1,f.showSetPasswordView=!0,f.showAlreadyGotTokenView=!1,f.showTokenActivationView=!1,l=e.primaryRegistrationPasswordValidation,f.getInformationDetail()},function(c){a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error while validating token. Please, try agin later.")})},f.checkPassword=function(a,b){return a===b},f.setPassword=function(){if(!f.passwordDto||!f.signUpDto)return!1;a.showInformation=!0,f.loginDto={esewaId:f.signUpDto.esewaId,password:f.passwordDto.newPassword},f.clearMessage();var c={token:f.tokenDto.token,esewaId:f.signUpDto.esewaId,password:f.passwordDto.newPassword,mpin:f.passwordDto.mpin};d.setPassword(c).then(function(b){f.successResponse=b.plain(),f.successResponse.message&&j(function(){a.successMessageForIndex=!0,a.message.success=f.successResponse.message},500),a.showSignUpForm=!1,angular.isFunction(a.login)?(a.showWelcomePage=!1,f.showRegFormView=!0,f.showTokenValidationView=!1,f.showSetPasswordView=!1,f.showAlreadyGotTokenView=!1,f.showTokenActivationView=!1,a.showApplicationProcessing=!0,a.login(f.loginDto)):(f.loginDto={},h.go(StateConstant.LOGIN))},function(c){a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error while validating token. Please, try agin later.")})},f.registerUserIdAndToken=function(){return!!f.activationDto&&(f.clearMessage(),void d.validateLastToken(f.activationDto).then(function(a){f.tokenDto={token:f.activationDto.token},f.signUpDto={esewaId:f.activationDto.esewaId,termsAndCondition:!0},f.showRegFormView=!1,f.showTokenValidationView=!1,f.showSetPasswordView=!0,f.showAlreadyGotTokenView=!1,f.showTokenActivationView=!1},function(c){a.showInformation=!1,angular.isDefined(c)&&(c.data.error_message?b.error(c.data.error_message,""):a.message.error="Error while validating token. Please, try agin later.")}))},f.showTokenActivation=function(){f.clearMessage(),a.showInformation=!0,l=e.primaryRegistration,f.getInformationDetail(),f.showRegFormView=!1,f.showTokenActivationView=!0,f.showAlreadyGotTokenView=!0},f.getInformationDetail=function(){a.informationKey=l,f.clearMessage(),a.$broadcast(c.information)},f.validateRegisterForm=function(){return!(!f.signUpDto.esewaId||!f.signUpDto.termsAndCondition)}}])}(),function(){angular.module("esewaUserApp").controller("ForgotPasswordController",["$scope","$rootScope","$state","$http","ForgotPasswordService","$timeout","InformationService","INFORMATION","$sce","ecmsg","RegexConstant","StateConstant","AUTH_EVENTS","vcRecaptchaService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){b.informationKey=q,b.$broadcast(m.information)}a.showForgotPasswordFirstForm=!0,a.forgotPasswordShow=function(){a.clearMessage(),b.esewaId="",a.showForgotPasswordForm=!0,a.showForgotPasswordFirstForm=!0,a.showForgotPasswordSecondForm=!1,a.showForgotPasswordThirdForm=!1,c.go(l.FORGOT_PASSWORD)},a.forgotPasswordDto={esewaId:"",token:""};var p;a.getRecaptchaId=function(a){p=a},a.forgotPwdRegister=function(){n.getResponse(p)?(e.validateForgotPasswordId(a.forgotPasswordDto.esewaId,n.getResponse(p)).then(function(d){a.forgotPassword=d.plain(),a.typeOfMobile(a.forgotPasswordDto.esewaId)?(a.showForgotPasswordFirstForm=!1,a.showForgotPasswordSecondForm=!0,b.clearMessage()):(j.success("We have sent you an email with a link to reset password. Please check your email and follow the instructions.",""),c.go(l.LOGIN))},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message):b.message.error="Service is currently unavailable. Please, Try again later.")}),n.reload(p)):b.message.error="Please resolve the captcha and submit!"},a.typeOfMobile=function(a){return k.mobileNo.test(a)},a.validateTokenForgotPwd=function(){e.validateToken(a.forgotPasswordDto).then(function(c){a.tokenValidationResponse=c.plain(),a.showForgotPasswordFirstForm=!1,a.showForgotPasswordSecondForm=!1,a.showForgotPasswordThirdForm=!0,b.clearMessage()},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message,""):j.error("Service is currently unavailable. please, try again later to set password for the credentials."))})},a.setPasswordForGotPwd=function(){a.setPasswordDto={token:a.forgotPasswordDto.token,password:a.passwordDto.newPassword,esewaId:a.forgotPasswordDto.esewaId},e.setPasswordForgotPassword(a.setPasswordDto).then(function(c){a.forgotPassword=c.plain(),f(function(){a.successMessageForIndex=!0,b.message.success=a.forgotPassword.message,b.message.success||(b.message.success="Password has been successfully changed."),j.success(b.message.success,"")},500),b.logout()},function(a){b.showInformation=!1,angular.isDefined(a)&&(a.data.error_message?j.error(a.data.error_message,""):b.message.error="Service is currently unavailable. please, try again later to set password for the credentials.")})},a.passwordDto={newPassword:"",confirmNewPassword:""},a.checkPassword=function(){return a.passwordDto.newPassword===a.passwordDto.confirmNewPassword};var q=h.forgotPassword;a.getInformation=function(){o()},a.cancel=function(){c.go(l.HOME_MAIN)}}])}(),function(){angular.module("esewaUserApp").controller("StaticController",["$scope","$state","$rootScope","StateConstant",function(a,b,c,d){a.staticMenus=[{url:d.TOPUP,name:"Direct Topup"},{url:d.AIRLINES_HOME,name:"Airlines"},{url:d.WU,name:"Fund Transfer"}],a.setShowStaticContent=function(d){c.showStaticContent=!0,a.showStaticContent=!0,b.go(d)}}])}(),function(){angular.module("esewaUserApp").controller("BankInfoController",["$scope","$rootScope","$state","InformationService",function(a,b,c,d){d.getInternetBankingDetails().then(function(b){a.internetBankingDetails=b.plain().bank_list},function(a){angular.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."}),d.getMobileBankingDetails().then(function(b){return a.mobileBankingDetails=b.plain().bank_list,a.mobileBankingDetails},function(a){angular.isDefined(a)?b.message=a.data.error_message:b.message="Error while fetching data."})}])}(),function(){angular.module("esewaUserApp").controller("ActivationController",["$scope","$rootScope","$state","$stateParams","ActivationService","ecmsg","$sce","INFORMATION","InformationService","$timeout","StateConstant","AUTH_EVENTS",function(a,b,c,d,e,f,g,h,i,j,k,l){a.token=d.token,a.currentState=c.current.name;var m="";a.esewaId="",b.message.error="","activate.setPasswordForEmailUser"===a.currentState&&e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!1)},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}),"activate.setPasswordForPrimaryUser"===a.currentState?e.getUserTokenActivation(a.token,"USER_ACTIVATION").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username,a.showToken=!0,e.sendPrimaryUserToken(a.esewaId,a.token).then(function(b){a.response=b.plain(),a.token=""},function(a){console.log(a),a.data.error_message?f.error(a.data.error_message,""):f.error("Activation link is either invalid or expired !!",""),c.go("login")}))},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}):"activate.setForgottenPassword"===a.currentState&&e.getUserTokenActivation(a.token,"FORGET_PASSWORD").then(function(b){a.response=b.plain(),a.response&&(a.esewaId=a.response.username),m=h.forgotPasswordValidation},function(){f.error("Activation link is either invalid or expired !!",""),c.go("login")}),a.password={password:"",confirm_password:""},a.setPasswordForEmailUser=function(){(a.esewaId||a.passwordDto.mobileToken||"activate.setPasswordForPrimaryUser"!==a.currentState)&&(a.tokenDto={token:a.token,mobileToken:a.passwordDto.mobileToken},a.passwordDto.newPassword===a.passwordDto.confirmNewPassword?e.setPasswordForEmailUser(a.esewaId,a.tokenDto,a.passwordDto).then(function(b){f.success(b.plain().message,""),c.go("login"),a.disableSubmit=!1},function(b){a.disableSubmit=!1,angular.isDefined(b.data.error_message)?f.error(b.data.error_message,""):f.error("Invalid Request !!","")}):f.error("Please, Check your password !!",""))},a.setNewForgottenPassword=function(){a.setPasswordDto={token:a.token,password:a.passwordDto.password},a.disableButtonCondition()?f.error("Invalid password format.",""):e.setNewForgottenPassword(a.esewaId,a.setPasswordDto).then(function(a){f.success(a.plain().message,""),c.go("login")},function(a){angular.isDefined(a.data)?f.error(a.data.error_message,""):f.error("Invalid request!","")})},a.checkPassword=function(){return a.password.password===a.password.confirm_password},a.checkPasswordValid=function(a,b){return a===b},a.checkPasswordRegex=function(a){return/[a-zA-z]/.test(a)&&/[0-9]/.test(a)&&a.length>7},a.disableButtonCondition=function(){return!a.checkPasswordRegex(a.passwordDto.password)||!a.checkPasswordRegex(a.passwordDto.confirm_password)||!a.checkPasswordValid(a.passwordDto.password,a.passwordDto.confirm_password)},a.cancel=function(){c.go("login")},a.showInformation=!1,m&&(b.informationKey=m,b.$broadcast(l.information)),a.addNotification=function(){console.log("Error"),f.error("You must be logged in for this operation.","")}}])}(),function(){angular.module("esewaUserApp").service("ActivationService",["Restangular",function(a){this.getUserTokenActivation=function(b,c){var d=_.merge({activation_type:c},{token:b});return a.one("token").one("validate").get(d)},this.setPasswordForEmailUser=function(b,c,d){var e={token:c.token};return c.mobileToken&&(e.token=c.mobileToken),a.one("esewa").one(b+"").one("create_password").customPOST(e,"","",{password:d.newPassword,username:d.username,mpin:d.mpin})},this.setNewForgottenPassword=function(b,c){return a.one(b+"").one("forgot_password").customPUT(c)},this.resendNotification=function(b,c){var d={type:b,notification_id:c};return a.one("auth").one("token").one("resend").customPUT(d)},this.sendPrimaryUserToken=function(b,c){var d={esewa_id:b,token:c};return a.one("esewa").one("verify_email").customPOST(d)}}])}();