/*! 
 * ec-payment-menu v3.15
 * https://dev.esewa.com.np
 * Version: 3.15
+; * Copyright (c) 2019 eSewa Developers <developers@esewa.com.np>
 * License: eSewa
 */
angular.module("esewaPaymentMenuApp",["restangular","ngStorage","esewaMessages","esewaSharedApp","ui.router","infinite-scroll"]).run(["$rootScope","$state","$localStorage","$http","$timeout","$sce","$location","$templateCache",function(a,b,c,d,e,f,g,h){}]),angular.module("esewaPaymentMenuApp").controller("OfferDetailController",["$scope","$stateParams","CDNUrl","$rootScope","$localStorage",function(a,b,c,d,e){var f=angular.isUndefined(e.user);console.log(f),f||"POINT"!==e.user.organizationType&&d.goToState("organization"),a.offerDetailTemplateUrl=c.url+"/html/offers/"+(f?"user/":"")+b.product_name+".html",console.log(a.offerDetailTemplateUrl)}]),angular.module("esewaPaymentMenuApp").controller("PaymentMenuController",["$state","$scope","$rootScope","StateConstant","$timeout","$location","PaymentMenuService",function(a,b,c,d,e,f,g){function h(a){angular.isDefined(a)&&(c.productMenus=a.plain(),_.forEach(c.productMenus,function(a){if(a.products=_.chunk(a.products,11),a.childMenus){var b=10,c=30;_.forEach(a.childMenus,function(a){if(a.products.length<=c)b=10;else if(a.products.length>c){var d=Math.ceil((a.products.length-c)/3);b+=d}a.products=_.chunk(a.products,b),a.arrayLength=a.products.length})}}),i())}function i(){(a.current.name===d.HOME_MAIN||a.current.name===d.LOGIN||a.current.name.startsWith("merchant"))&&(c.showPaymentMenu=!0),b.productMenus=c.productMenus,_.each(b.productMenus,function(a,c){b.showChildMenus[c]=!1}),a.current.name!==d.LOGIN&&a.current.name!==d.HOME_MAIN||(c.showAddServices=!0),j()}function j(){c.$$phase||c.$apply()}b.showChildMenus=[],b.menu={product:{}},angular.isUndefined(c.productMenus)?g.getPaymentMenu().then(function(a){h(a)},function(){c.productMenus=[],j()}):i(),b.getThePaymentClass=function(a){return temp=4*a,"col-lg-"+temp},b.getThePaymentInnerClass=function(a){return colVal=12/a,"col-lg-"+colVal},b.showChildMenu=function(a,d){c.globalclick=!1,e(function(){if("AGGREGATE"===d.menuType)return void f.path(d.aggregateUrl);_.each(b.showChildMenus,function(c,d){b.showChildMenus[d]=d===a&&!b.showChildMenus[d]})},0)},b.closeAllMenus=function(){c.globalclick=!0},b.getDetails=function(b,e,g){c.isAuthenticated()?"AGGREGATE"===g.menuType?f.path(g.aggregateUrl):a.go(d.MAKE_PAYMENT,{product_code:b,product_name:e},{reload:!0}):c.openLoginDialog("/#/make_payment/"+b+"/"+e)};var k=["auth","authentication","user","activateNotification","activate","merchant.airlines","static","home.main.initialRequirement","fundFrom"],l=["user.statements","static","fundFrom"];c.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0,c.currentModal&&!a.current.name.startsWith(d.MAKE_PAYMENT)&&c.currentModal.dismiss(),c.showMostUsedServices=!1,c.showAddServices=!1,c.showPaymentMenu=!0,a.current.name===d.LOGIN||a.current.name===d.HOME_MAIN?(c.showMostUsedServices=!0,c.showAddServices=!0,c.message.error=""):a.current.name.startsWith("static")&&(c.message.error=""),c.showBreadCumb=!0,_.each(k,function(b){_.startsWith(a.current.name,b)&&(c.showPaymentMenu=!1,c.showBreadCumb=!1)}),_.each(l,function(b){(_.startsWith(a.current.name,b)||"login"===a.current.name||"main.landing"===a.current.name)&&(c.showBreadCumb=!1)})})}]).directive("paymentMenulist",[function(){return{restrict:"A",transclude:!1,link:function(a,b){a.$last&&$(".paymentMenu-parent").mouseenter(function(){var a=$(this),b=setTimeout(function(){a.addClass("hasBeen500ms")},500);a.mouseleave(function(){clearTimeout(b),a.removeClass("hasBeen500ms")})})}}}]).directive("onOutsideElementClick",["$document",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(a){a.stopPropagation()});var e=function(){b.$apply(function(){b.$eval(d.onOutsideElementClick)})};a.on("click",e),b.$on("$destroy",function(){a.off("click",e)})}}}]),angular.module("esewaPaymentMenuApp").service("PaymentMenuService",["Restangular",function(a){this.getProductForPayment=function(b){return a.all("payments").all("products").one(b).get()},this.getPaymentMenu=function(){return a.one("payment_menus").customGET()}}]),angular.module("esewaPaymentMenuApp").controller("ProductSearchController",["$scope","$filter","$window","$rootScope","$http","$location","$state","StateConstant","CDNUrl",function(a,b,c,d,e,f,g,h,i){function j(a){return{name:a.name,code:a.code,image:a.logo,url:a.url,redirect:a.redirectExternal}}a.searching=!1,a.product="";var k=[],l=d.$storage.user?i.url+"/data/orgSearchState.json":i.url+"/data/userSearchState.json";e.get(l).success(function(a){k=a.data}),a.search=function(b){a.searching=!0,a.product=b;var c=[],d=[],f=[];return k.forEach(function(a){a.name.toLowerCase().startsWith(b.toLowerCase())&&c.push(a)}),e({method:"GET",url:"api/web/payments/products",params:{q:b}}).then(function(b){if(a.searching=!1,0===b.data.length)0===c.length&&c.push({name:"Product not available."});else{for(var e=0;e<b.data.length;e++)b.data[e].redirectExternal?d.push(j(b.data[e])):f.unshift(j(b.data[e]));f.length&&f.push({saperatorLine:!0}),c=c.concat(f,d)}return c},function(){return c})},a.onProductSelected=function(e){if(e){if(a.product.state)return void d.goToState(a.product.state);if(a.product.redirect){if(a.product.redirect){var f=b("UrlCode")(a.product.url);c.open(f,"_blank")}}else d.isAuthenticated()?g.go(h.MAKE_PAYMENT,{product_code:a.product.code,product_name:a.product.name}):d.openLoginDialog("/#/make_payment/"+a.product.code+"/"+a.product.name)}}}]),angular.module("esewaPaymentMenuApp").directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(a,b){a.$last&&a.initCarousel(b.parent())}}}]).directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(a){a.initCarousel=function(b){var c={},d=a.$eval($(b).attr("data-options"));for(var e in d)c[e]=d[e];$(b).owlCarousel(c).owlCarousel({loop:!0,nav:!0,margin:10,responsive:{0:{items:1},600:{items:3},960:{items:5},1200:{items:6}}})}}}}),angular.module("esewaPaymentMenuApp").run(["ShowcaseService","$sce","CDNUrl","$modal","$state","$timeout","$rootScope","$window",function(a,b,c,d,e,f,g,h){g.data={showcases:[]},g.getShowCaseData=function(){g.data.showcases.length||a.getShowcase().then(function(a){for(var b=[],c=a.plain(),d=0;d<c.length;d++)b.push({name:c[d].name,badge:c[d].badge,detail:c[d].detail,logo:c[d].image_url,offer:c[d].offer,order:c[d].position,code:c[d].code,showcased:c[d].showcase,value:c[d].value,displayName:c[d].displayName});Object.assign(g.data.showcases,b)},function(){return[]})},g.getProductShowcaseDetail=function(a,c){if(a.detail&&c)angular.isObject(a.detail)||(a.detail=b.trustAsHtml(a.detail)),g.openShowcaseDetailDialog(a);else{if(angular.isDefined(g.isAuthenticated)&&!g.isAuthenticated())return void g.openLoginDialog("/#/make_payment/"+a.code+"/"+a.displayName);e.go("merchant.makePayment",{product_code:a.code,product_name:a.name},{reload:!0})}},g.redirectToExternalUrl=function(a){h.open(a,"_blank")},g.openShowcaseDetailDialog=function(a){d.open({templateUrl:c.url+"/html/showcase/modal_showcase_detail.html",controller:i,size:"lg ShowcaseDetails",resolve:{showcase:function(){return a}}})},g.showcaseViewAll=function(b){a.getShowcaseByLevel(b).then(function(a){g.allShowcase=a.plain(),e.go("allShowcase")},function(a){})};var i=["$rootScope","$scope","showcase","$modalInstance",function(a,b,c,d){b.showcase=c,b.cancel=function(){d.dismiss()},a.currentModal=d}]}]),angular.module("esewaPaymentMenuApp").service("ShowcaseService",["Restangular","PaginationService",function(a){this.getShowcase=function(){return a.all("products").all("showcase").getList()},this.getShowcaseByLevel=function(b){return a.all("products").all("showcase/"+b).customGET()}}]),angular.module("esewaPaymentMenuApp").config(["$stateProvider","$urlRouterProvider","CDNUrl",function(a,b,c){function d(a){return c.url+a}a.state("allShowcase",{templateUrl:d("/html/showcase/all_showcase.html"),data:{displayName:"All Showcase"}})}]);